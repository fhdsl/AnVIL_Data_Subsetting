# Bringing the WDL Workflow to AnVIL

## Find the Workflow on Dockstore

Navigate to the Workflows tab of your Workspace. Select "Find a Workflow". 

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_0")
```

When the dialog box opens, select "Dockstore" on the bottom left. This will take you to the Dockstore search page.

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_5")
```

Enter fastq_subsample in the search box. Select the workflow "fhdsl/AnVIL_WDLs/fastq_subsample".

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_21")
```

## Send the Workflow to AnVIL

On the right side "Launch with" menu, select "AnVIL". This will open a new tab.

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_26")
```

Select the appropriate Workspace where you want the workflow to appear. Select "IMPORT".

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_31")
```

You should now be back on AnVIL!

# Set Up the Workflow

## Set Up Inputs

Use the "SELECT DATA" button to select the samples (rows) where you want to create fastq subsets. You can select all or some samples.

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_45")
```

Columns of your "DATA" table are used as workflow inputs. You need to specify these. 

The first workflow input is a fastq or zipped fastq file. The workflow calls this input `fastqgz_file_read_1`. Under "Attribute" select the column that contains a link to the first set of reads. 

:::{.notice}
For single-end sequencing, the `fastqgz_file_read_1` input is the only file containing sequencing reads in your data.

For paired-end sequencing, the `fastqgz_file_read_1` input is the first of two read files.
:::

In this example, the column with the fastq file link is called "read1". It will look like "this.read1" under "Attribute".

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_50")
```

Select additional inputs. 

- [**Required**]: In this example, we've selected "sample_id" as the column containing the name of the sample. This helps with naming the file. 

- [**Optional**]: "read2" indicates the second set of reads in our paired-end sequencing approach. Skip this if you have single-end reads.

- [**Optional**]: Indicate how many reads you want in your subsample file. In this example, we wanted 20,000 reads. (Default: 10,000)


```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_55")
```

## Set Up Outputs

Workflow outputs are written to a Google Bucket when run on AnVIL. Setting up the workflow outputs allows us to create links to these outputs inside the DATA table in our Workspace, making them easier to locate. 

Select the "OUTPUTS" tab. Select "Use defaults" to use the default output column naming schema. 

```{r, fig.align='center', echo = FALSE, fig.alt= "", out.width = '100%'}
ottrpal::include_slide("https://docs.google.com/presentation/d/1zUiupDXMZlZEIditsN5igggOim9qIrR9Ckf4N8fSAB8/edit#slide=id.g2794677b0ab_0_60")
```
